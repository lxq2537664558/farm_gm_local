<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>邮件操作</title>
    <link rel="stylesheet" href="__PUBLIC__/assets/css/amazeui.css" />
    <link rel="stylesheet" href="__PUBLIC__/assets/css/admin.css" />

    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/ueditor.all.min.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/lang/zh-cn/zh-cn.js"></script>
    <script type="text/javascript">var ue = UE.getEditor('editor');</script>
</head>
<body>
<div class="admin" style="width: 100%; height: 100%;">
    <include file="Common@Common:sidebar" />
    <div class="content-page" style="position: absolute; left: 15%; width:85%;">
        <div class="basic-add-mail">
            <div class="title" style="margin-left: 10px;">
                <a href="{:U('Home/Basic/basicMail')}" style="color: gray;"><h2 style="display: inline-block;">邮件</h2></a>
                <h2 style="display: inline-block; margin-left: 20px;">添加邮件</h2></a>
            </div>
            <form action="{$url}" method="post">
                <span style="display: inline-block; width: 100px;">邮件标题</span><input class="mail_title" type="" name="title" value="{$info['title']}"><br>
                <span style="display: inline-block; width: 100px; margin-top: 15px;">邮件内容</span><textarea class="mail_content" name="content" style="width: 300px; height: 200px; margin-top: 20px; margin-bottom: 20px;">{$info['content']}</textarea><br>
                <span style="display: inline-block; width: 100px;">邮件接收UID</span><input type="text" name="uid" value="{$info['uid']}"><span style="color: red; margin-left: 10px;">若全服发送则填写数字0</span><br>
                <span style="display: inline-block; width: 100px; margin-top: 20px;">礼品ID</span><input style="width: 180px;" type="item_ids" name="item_ids" readonly="readonly" id="itemid_input" required="required" placeholder="下拉框选择(不能为空)" value="{$info['item_ids']}">
                <select id="select_itemid" style="margin-left: 10px;">
                    <option>请选择礼品</option>
                    <foreach name="products" item="p">
                        <option value="{$p['pid']}">{$p['name']}</option>
                    </foreach>
                </select>
                <span id="clear_itemid" style="display: inline-block; font-size: 12px; cursor: pointer; border: 1px solid gray; border-radius: 5px; width: 40px; text-align: center;">清空</span><br>
                <span class="item_number_span" style="display: inline-block; width: 90px; margin-top: 20px;">礼品数量</span><input class="item_number" type="hidden" name="item_number" value="{$info['item_number']}" placeholder="与礼品ID一一对应" /><br>
                <input class="submit" type="submit" style="width: 100px; margin-left: 10px; background: #4CA3FF; border: 1px solid gray; border-radius: 5px; color: white; height: 30px; margin-top: 30px;">
            </form>
        </div>
    </div>
</div>
<script type="text/javascript" src="__PUBLIC__/assets/js/jquery-2.1.0.js" ></script>
<script type="text/javascript" src="__PUBLIC__/assets/js/amazeui.min.js"></script>
<script type="text/javascript">
    $('#collapse-nav8').addClass('am-in');

    if($('.item_number').val()!=""){
        console.log($('.item_number').val());

        var item_number = $('.item_number').val();
        var item_number = item_number.split(",");
        var change_num = item_number.length;
        for(var i = 0; i<=item_number.length; i++){
            if(i==1){
                $('.item_number_span').after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
                $('.item_number_input').eq(0).val(item_number[i-1]);
            }else if(i==2){
                $('.item_number_input').eq(0).after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
                $('.item_number_input').eq(1).val(item_number[i-1]);
            }else if(i==3){
                $('.item_number_input').eq(1).after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
                $('.item_number_input').eq(2).val(item_number[i-1]);
            }else if(i==4){
                $('.item_number_input').eq(2).after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
                $('.item_number_input').eq(3).val(item_number[i-1]);
            }else if(i==5){
                $('.item_number_input').eq(3).after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
                $('.item_number_input').eq(4).val(item_number[i-1]);
            }else if(i==5){
                $('.item_number_input').eq(4).after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
                $('.item_number_input').eq(5).val(item_number[i-1]);
            }
        }
    }else{
        var change_num = 0;
    }



    var href = window.location.href;
    if(href.indexOf('id')!=-1){
        $('.title h2:nth-child(2)').text('邮件编辑');
    }else{
        $('.title h2:nth-child(2)').text('新增邮件');
    }

    // 选择邮件物品
    // var change_num = 0;
    // $('#select_itemid').change(function(){
    //     if($(this).val()=="请选择礼品"){
    //         return false;
    //     }

    //     if(change_num == 0){
    //         $('#itemid_input').val($(this).val());
    //     }else{
    //         $('#itemid_input').val($('#itemid_input').val()+","+$(this).val());
    //     }
    //     change_num++;
    //     // $('#itemid_input').css('width',30*change_num+"px")
    // })


    // 选择邮件礼品
    $('#select_itemid').change(function(){
        if($(this).val()=="请选择礼品"){
            return false;
        }
        if(change_num == 0){
            $('#itemid_input').val($(this).val());
            $('.item_number_span').after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
        }else if(change_num==1){
            $('#itemid_input').val($('#itemid_input').val()+","+$(this).val());
            $('.item_number_input').eq(0).after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
        }else if(change_num==2){
            $('#itemid_input').val($('#itemid_input').val()+","+$(this).val());
            $('.item_number_input').eq(1).after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
        }else if(change_num==3){
            $('#itemid_input').val($('#itemid_input').val()+","+$(this).val());
            $('.item_number_input').eq(2).after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
        }else if(change_num==4){
            $('#itemid_input').val($('#itemid_input').val()+","+$(this).val());
            $('.item_number_input').eq(3).after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
        }else if(change_num==5){
            $(this).attr('disabled',true);
            $('#itemid_input').val($('#itemid_input').val()+","+$(this).val());
            $('.item_number_input').eq(4).after('<input class="item_number_input" type="text" value="" style="width: 50px; margin-left: 10px;">');
        }
        change_num++;
    })


    $('#clear_itemid').click(function(){
        change_num=0;
        $('#itemid_input').val("");
        $('.item_number_input').remove();
        $('.item_number').val("");
        $('#select_itemid').attr('disabled',false);
        // $('#itemid_input').css('width',180+"px")
    })


    $('.submit').click(function(){
        var reg = new RegExp("^[0-9]*$");
        var a = false;
        for(var i = 0; i < $('.item_number_input').length; i++){
            if($('.item_number_input').eq(i).val()==""){
                alert("礼品数量不能为空");
                a = false;
                return a;
            }else if(!reg.test($('.item_number_input').eq(i).val())){
                alert("礼品数量必须为正整数");
                a = false;
                return a;
            }else{
                a = true;
            }
        }

        if($('.mail_title').val()==""){
            alert("邮件标题不能为空");
            a = false;
            return a;
        }

        if(a==true){
            if(change_num==1){
                $('.item_number').val($('.item_number_input').eq(0).val());
            }else if(change_num==2){
                $('.item_number').val($('.item_number_input').eq(0).val()+','+$('.item_number_input').eq(1).val());
            }else if(change_num==3){
                $('.item_number').val($('.item_number_input').eq(0).val()+','+$('.item_number_input').eq(1).val()+','+$('.item_number_input').eq(2).val());
            }else if(change_num==4){
                $('.item_number').val($('.item_number_input').eq(0).val()+','+$('.item_number_input').eq(1).val()+','+$('.item_number_input').eq(2).val()+','+$('.item_number_input').eq(3).val());
            }else if(change_num==5){
                $('.item_number').val($('.item_number_input').eq(0).val()+','+$('.item_number_input').eq(1).val()+','+$('.item_number_input').eq(2).val()+','+$('.item_number_input').eq(3).val()+','+$('.item_number_input').eq(4).val());
            }else if(change_num==6){
                $('.item_number').val($('.item_number_input').eq(0).val()+','+$('.item_number_input').eq(1).val()+','+$('.item_number_input').eq(2).val()+','+$('.item_number_input').eq(3).val()+','+$('.item_number_input').eq(4).val()+','+$('.item_number_input').eq(5).val());
            }
                console.log($('.item_number').val());
                return true;
            }
    })

</script>
<script type="text/javascript" src="__PUBLIC__/assets/js/nav.js"></script>
</body>
</html>
